<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>US Signal | On-Call Administration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="./ussignal.jpg" type="image/jpeg" />
  <link rel="stylesheet" href="style.css" />

  <!-- =========================
       ENTERPRISE UX ENHANCEMENTS
  ========================= -->
  <style>
    /* ===== MODAL ===== */
    .modal { opacity:0; pointer-events:none; transition:opacity 160ms ease; }
    .modal.modal-open { opacity:1; pointer-events:auto; }
    .modal-card { transform:translateY(12px) scale(.98); opacity:0; transition:all 180ms ease; }
    .modal.modal-open .modal-card { transform:none; opacity:1; }

    /* ===== CURRENT ON-CALL BADGE ===== */
    .schedule-card.current-oncall {
      border-left: 6px solid #16a34a;
      box-shadow: 0 0 0 1px rgba(22,163,74,.35);
      position: relative;
    }
    .schedule-card.current-oncall::before {
      content: "CURRENT";
      position: absolute;
      top: 10px;
      right: 12px;
      background: #16a34a;
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 999px;
      letter-spacing: .5px;
    }

    /* ===== WHO'S ON CALL LIVE ===== */
    .current-oncall-live {
      border-left: 6px solid #0ea5e9;
      background: linear-gradient(90deg, rgba(14,165,233,.08), transparent);
    }

    /* ===== HARD LOCK PAST WEEKS ===== */
    .schedule-card.past-week {
      opacity: .55;
      filter: grayscale(.15);
    }
    .schedule-card.past-week input,
    .schedule-card.past-week button.primary {
      pointer-events: none;
      opacity: .6;
      cursor: not-allowed;
    }
    .schedule-card.past-week .card-head::after {
      content: "PAST WEEK (LOCKED)";
      display: block;
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }

    /* ===== INLINE EDIT FOCUS ===== */
    .entry input:focus {
      outline: 2px solid #2563eb;
      outline-offset: 1px;
    }

    /* ===== LIVE TAB ===== */
    #currentOnCall .schedule-card {
      margin-bottom: 16px;
    }

    .small.subtle {
      color: #6b7280;
    }
    #psCustomersTab input {
  width: 100%;
  padding: 6px 8px;
  font-family: monospace;
}

#psCustomersTab input[maxlength="5"] {
  letter-spacing: 1px;
  text-align: center;
}

  </style>
</head>

<body class="light">

<header class="topbar">
  <div class="brand">
    <img src="ussignal.jpg" class="logo" />
    <div>
      <div class="brand-title">US Signal</div>
      <div class="brand-sub">On-Call Administration</div>
    </div>
  </div>

  <div class="controls">
    <button id="themeToggle" class="ghost">üåô</button>
    <span id="roleBadge" class="role-badge"></span>

    <select id="deptFilter">
      <option value="all">All Departments</option>
      <option value="enterprise_network">Enterprise Network</option>
      <option value="collaboration">Collaboration</option>
      <option value="system_storage">System & Storage</option>
    </select>

    <button id="saveAllBtn" class="primary">Save</button>
    <button id="revertBtn" class="ghost">Revert</button>
    <button id="notifyBtn" class="ghost">Notify</button>
  </div>
</header>

<!-- =========================
     TABS
========================= -->
<nav class="tabs">
  <button class="tab active" data-tab="scheduleTab">Schedule</button>
  <button class="tab" data-tab="currentTab">Who‚Äôs On Call Now</button>
  <button class="tab" data-tab="psCustomersTab" data-requires="admin">PS Customers </button>
  <button class="tab" data-tab="rosterTab" data-requires="admin">Roster</button>
  <button class="tab" data-tab="autogenTab" data-requires="admin">Auto-Generate</button>
  <button class="tab" data-tab="auditTab" data-requires="admin">Audit</button>
  <button class="tab" data-tab="historyTab" data-requires="admin">History</button>
  
</nav>

<main class="container">

  <!-- SCHEDULE -->
  <section id="scheduleTab" class="panel active">
  <div class="panel-head">
    <h2>On-Call Schedule</h2>
    <div class="panel-actions">
      <button id="addScheduleBtn" class="primary">Add Schedule</button>

      <!-- BULK UPLOAD -->
      <label class="ghost file-btn">
        Bulk Upload (CSV / Excel)
        <input
          id="scheduleUploadInput"
          type="file"
          accept=".csv,.xlsx"
          hidden
        />
      </label>
            <!-- DOWNLOAD -->
      <button id="scheduleDownloadBtn" class="ghost">
        Download Schedule
      </button>
    </div>
  </div>

  <div class="small subtle" style="margin-bottom:10px">
    CSV/Excel columns required:
    <b>startISO, endISO, department, name, email, phone</b>
  </div>

  <div id="schedule"></div>
</section>

  <!-- WHO'S ON CALL NOW -->
  <section id="currentTab" class="panel">
    <div class="panel-head">
      <h2>Who‚Äôs On Call Now</h2>
      <div class="small subtle">Live ¬∑ Inline editable ¬∑ Auto-refreshing</div>
    </div>
    <div id="currentOnCall"></div>
  </section>

  <!-- TIMELINE -->
  <section id="timelineTab" class="panel">
    <h2>Weekly Timeline</h2>
    <div id="timeline"></div>
  </section>

  <!-- ROSTER -->
 <section id="rosterTab" class="panel">
  <div class="panel-head">
    <h2>Roster Management</h2>
    <div class="panel-actions">
      <button id="rosterAddUserBtn" class="primary">Add User</button>
      <button id="rosterSaveBtn" class="ghost">Save</button>
      <button id="rosterReloadBtn" class="ghost">Reload</button>

      <!-- BULK UPLOAD -->
      <label class="ghost file-btn">
        Bulk Upload (CSV / Excel)
        <input
          id="rosterUploadInput"
          type="file"
          accept=".csv,.xlsx"
          hidden
        />
      </label>
            <!-- DOWNLOAD -->
      <button id="rosterDownloadBtn" class="ghost">
        Download Roster
      </button>
    </div>
  </div>

  <div class="small subtle" style="margin-bottom:10px">
    CSV/Excel columns required:
    <b>department, name, email, phone</b>
  </div>

  <div id="roster"></div>
</section>
  <!-- AUTO-GEN -->
  <section id="autogenTab" class="panel">
    <h2>Auto-Generate Schedule</h2>
    <div class="form-row">
      <label>Start</label><input type="date" id="autogenStart" />
      <label>End</label><input type="date" id="autogenEnd" />
      <label>Seed</label><input type="number" id="autogenSeed" value="0" />
      <button id="runAutogenBtn" class="primary">Run</button>
    </div>
      <!-- PS Customers -->
<section id="psCustomersTab" class="panel">
  <div class="panel-head">
    <h2>Professional Services Customers</h2>

    <div class="panel-actions">
      <button id="psAddCustomerBtn" class="primary">Add Customer</button>
      <button id="psSaveCustomersBtn" class="ghost">Save</button>
      <button id="psReloadCustomersBtn" class="ghost">Reload</button>
    </div>
  </div>

  <div class="small subtle" style="margin-bottom:10px">
    PINs must be <b>exactly 5 digits</b>. SMS authentication and IVR validation rely on these values.
  </div>

  <!-- ‚úÖ APP.JS RENDERS HERE -->
  <div id="psCustomers"></div>

  <div class="small subtle" style="margin-top:12px">
    Changes are not active until <b>Save</b> is clicked.
  </div>
</section>

  
  <!-- AUDIT -->
  <section id="auditTab" class="panel">
    <div class="panel-head">
      <h2>Audit Log</h2>
      <button id="auditRefreshBtn" class="ghost">Refresh</button>
    </div>
    <div id="audit"></div>
  </section>

  <section id="accessDeniedTab" class="panel">
    <div class="access-denied">
      <h2>Access Restricted</h2>
      <p>Contact an administrator if you believe this is an error.</p>
    </div>
  </section>
<!-- HISTORY -->
<section id="historyTab" class="panel">
  <div class="panel-head">
    <h2>Archived On-Call History</h2>
    <div class="small subtle">
      Past schedules are read-only and cannot be modified.
    </div>
      <!-- CRON Health-->
<section id="cron-health" class="card">
  <h3>‚è± Cron Health</h3>
  <pre id="cron-health-output">Loading‚Ä¶</pre>
</section>
  <!-- CRON STatus-->
  <section class="cron-health">
  <h3>‚è± Cron Health 2</h3>
  <pre id="cronHealthStatus">Loading‚Ä¶</pre>
</section>
  </div>

  <div id="history"></div>
</section>
</main>

<!-- MODAL -->
<div id="modal" class="modal hidden" role="dialog">
  <div class="modal-card">
    <div class="modal-head">
      <h3 id="modalTitle"></h3>
      <button id="modalClose">‚úï</button>
    </div>
    <div id="modalBody"></div>
    <div class="modal-actions">
      <button id="modalCancel" class="ghost">Cancel</button>
      <button id="modalOk" class="primary">Save</button>
      <button id="modalSaveAddAnother" class="ghost">Save & Add Another</button>
    </div>
  </div>
</div>

<div id="toast" class="toast hidden"></div>

<script>
  window.__APP_CTX__ = {
    admin: true,
    role: "admin",
    email: "{{CF-Access-Authenticated-User-Email}}"
  };
</script>
<script type="module" src="app.js"></script>

</body>
</html>
